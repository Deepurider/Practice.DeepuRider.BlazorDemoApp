@page "/"
@using Practice.DeepuRider.Application.Interfaces
@rendermode InteractiveServer
@inject IUserService userService;

@if (IsFormMode)
{
    <PageTitle>User Form</PageTitle>
    <button type="button" class="btn btn-primary" @onclick="ChangeToDataGridMode">Go to user list</button>
    <EditForm FormName="UserForm" Model="@user" OnValidSubmit="Submit">
        <div class="user-form-wrapper">
            <div class="user-form-card">
                <h3 class="user-form-title">User Form</h3>

                <div class="user-form-group">
                    <label class="user-label">Email</label>
                    <InputText @bind-Value="user.Email"
                               placeholder="Enter your email"
                               class="form-control user-input" />
                </div>

                <div class="user-form-group">
                    <label class="user-label">Name</label>
                    <InputText @bind-Value="user.Name"
                               placeholder="Enter your name"
                               class="form-control user-input" />
                </div>

                <div class="user-form-group">
                    <label class="user-label">Phone</label>
                    <InputText @bind-Value="user.Phone"
                               placeholder="Enter your phone"
                               class="form-control user-input" />
                </div>

                <button type="submit" class="btn btn-primary user-submit-btn">Go</button>
            </div>
        </div>
    </EditForm>
}

@if (!IsFormMode)
{
    <PageTitle>Users</PageTitle>
    <button class="btn btn-primary" type="button" @onclick="ChangeToFormMode">Create User</button>
    <table class="table table-striped table-bordered mt-2">
        <thead>
            <tr>
                <th>Id</th>
                <th>Name</th>
                <th>Email</th>
                <th>Phone</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var u in users)
            {
                <tr>
                    <td>@u.UserId</td>
                    <td>@u.Name</td>
                    <td>@u.Email</td>
                    <td>@u.Phone</td>
                </tr>
            }
        </tbody>
    </table>
}

@code {
    private Domain.Models.User user = new();
    private List<Domain.Models.User> users = new();
    private bool IsFormMode = false;

    protected async override Task OnInitializedAsync()
    {
        await GetUsers();
    }

    private async Task Submit()
    {
        var newUser = await userService.Create(user, default);
        await GetUsers();
        ChangeToDataGridMode();
    }

    private void ChangeToFormMode()
    {
        user = new();
        IsFormMode = true;
    }

    private void ChangeToDataGridMode()
    {
        IsFormMode = false;
    }

    private void Reset()
    {
        user.Email = string.Empty;
        user.Name = string.Empty;
        user.Phone = string.Empty;
    }

    private async Task GetUsers()
    {
        users = (await userService.GetListAsync(default)).ToList();
    }
}
